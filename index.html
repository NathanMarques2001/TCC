<!DOCTYPE html>
<html lang="PT-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&family=Roboto:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="shortcut icon"
      href="./assets/icon-logo.svg"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="style.css" />
    <title>IPizza</title>
  </head>

  <body>
    <header id="header">
      <h1>IPIZZA</h1>
      <img src="./assets/icon-logo.svg" alt="Logo IPizza" />
    </header>

    <main id="container">
      <h2 id="adicionar-sabor">ADICIONAR NOVO SABOR</h2>
      <div id="form-container">
        <div class="input-label">
          <label for="sabor">Sabor da Pizza</label>
          <input
            class="input"
            type="text"
            id="sabor"
            placeholder="Ex: Calabresa, Mussarela..."
          />
        </div>
        <div class="input-label">
          <label for="tamanho">Tamanho da Pizza</label>
          <select class="input" id="tamanho">
            <option value="pequeno">Pequeno (6 fatias)</option>
            <option value="medio">Médio (8 fatias)</option>
            <option value="grande">Grande (10 fatias)</option>
            <option value="gigante">Gigante (12 fatias)</option>
          </select>
        </div>
        <div class="input-label">
          <label for="tipo">Tipo da Pizza</label>
          <select class="input" id="tipo">
            <option value="doce">Doce</option>
            <option value="salgado">Salgado</option>
          </select>
        </div>
        <div class="input-label">
          <label for="ingredientes">Ingredientes da Pizza</label>
          <textarea
            class="input"
            id="ingredientes"
            placeholder="Ex: Molho, Calabresa, Queijo..."
          ></textarea>
        </div>
        <div class="input-label">
          <label for="imageInput">Imagem da Pizza</label>
          <input
            class="input"
            type="file"
            id="imageInput"
            accept="image/*"
            onchange="exibirImagem()"
          />
          <img
            id="previewImage"
            src="#"
            alt=""
            max-width="150px"
            max-height="150px"
          />
        </div>
        <input type="hidden" id="editar-indice" value="" />
        <!-- <button id="acao-button" onclick="criarPizza()">Adicionar</button> -->
        <button id="acao-button">Adicionar</button> 
      </div>

      <h2 id="titulo-lista">Lista de Pizzas</h2>
      <ul id="lista-pizzas"></ul>
    </main>

    <!-- LÓGICA 
    <script>
      const pizzas = [];

      function adicionarOuEditarPizza() {
        const sabor = document.getElementById("sabor").value;
        const tamanho = document.getElementById("tamanho").value;
        const tipo = document.getElementById("tipo").value;
        const ingredientes = document.getElementById("ingredientes").value;
        const editarIndice = document.getElementById("editar-indice").value;
        const acaoButton = document.getElementById("acao-button");
        const image = document.getElementById("imageInput").files[0];

        if (sabor) {
          if (editarIndice === "") {
            const pizza = { sabor, tamanho, tipo, ingredientes, image };
            pizzas.push(pizza);
          } else {
            const index = parseInt(editarIndice);
            pizzas[index].sabor = sabor;
            pizzas[index].tamanho = tamanho;
            pizzas[index].tipo = tipo;
            pizzas[index].ingredientes = ingredientes;
            pizzas[index].image = image;
            document.getElementById("editar-indice").value = "";
          }

          atualizarListaPizzas();
          limparCampos();
        }
      }

      function atualizarListaPizzas() {
        const listaPizzas = document.getElementById("lista-pizzas");
        listaPizzas.innerHTML = "";

        pizzas.forEach((pizza, index) => {
          const listItem = document.createElement("li");
          listItem.innerHTML = `<strong>Sabor:</strong> ${pizza.sabor}</br><strong>Tamanho:</strong> ${pizza.tamanho}</br><strong>Tipo:</strong> ${pizza.tipo}</br><strong>Ingredientes:</strong> ${pizza.ingredientes}`;
          listItem.appendChild(document.createElement("br"));

          if (pizza.image) {
            const imageElement = document.createElement("img");
            imageElement.src = URL.createObjectURL(pizza.image);
            imageElement.alt = "Imagem da Pizza";
            imageElement.style.maxWidth = "150px";
            imageElement.style.maxHeight = "150px";
            listItem.appendChild(imageElement);
          }

          const editarButton = document.createElement("button");
          editarButton.textContent = "Editar";
          editarButton.onclick = () => editarPizza(index);

          const deleteButton = document.createElement("button");
          deleteButton.textContent = "Excluir";
          deleteButton.onclick = () => excluirPizza(index);

          listItem.appendChild(document.createElement("br"));
          listItem.appendChild(editarButton);
          listItem.appendChild(deleteButton);
          listaPizzas.appendChild(listItem);
        });
      }

      function editarPizza(index) {
        const pizza = pizzas[index];
        document.getElementById("sabor").value = pizza.sabor;
        document.getElementById("tamanho").value = pizza.tamanho;
        document.getElementById("tipo").value = pizza.tipo;
        document.getElementById("ingredientes").value = pizza.ingredientes;
        document.getElementById("editar-indice").value = index;
        document.getElementById("acao-button").value = "Atualizar";

        if (pizza.image) {
          document.getElementById("previewImage").src = URL.createObjectURL(
            pizza.image
          );
        }
      }

      function excluirPizza(index) {
        if (confirm("Deseja realmente excluir esta pizza?")) {
          pizzas.splice(index, 1);
          atualizarListaPizzas();
        }
      }

      function limparCampos() {
        document.getElementById("sabor").value = "";
        document.getElementById("tamanho").value = "pequeno";
        document.getElementById("tipo").value = "doce";
        document.getElementById("ingredientes").value = "";
        document.getElementById("editar-indice").value = "";
        document.getElementById("previewImage").src = "";
        document.getElementById("imageInput").value = "";
      }

      function exibirImagem() {
        const input = document.getElementById("imageInput");
        const previewImage = document.getElementById("previewImage");

        const file = input.files[0];
        const reader = new FileReader();

        reader.onload = function (e) {
          previewImage.src = e.target.result;
        };

        if (file) {
          reader.readAsDataURL(file);
        }
      }

      atualizarListaPizzas();
    </script>

   
    
    <script type="module">
      import {
        getFirestore,
        collection,
        addDoc,
        deleteDoc,
        doc,
        setDoc,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";

      const firebaseConfig = {
        apiKey: "AIzaSyB3KuPCxDKFWaVlG-nCKp1ZrYwR2TuhPFI",
        authDomain: "ipizza-tcc.firebaseapp.com",
        projectId: "ipizza-tcc",
        storageBucket: "ipizza-tcc.appspot.com",
        messagingSenderId: "702160010379",
        appId: "1:702160010379:web:b4d4d29e95e1fe0b48288e",
        measurementId: "G-P1Y6ZS7GZL",
      };

      const saborInput = document.getElementById("sabor");
      const tamanhoInput = document.getElementById("tamanho");
      const tipoInput = document.getElementById("tipo");
      const ingredientesInput = document.getElementById("ingredientes");
      const criarPizzaButton = document.getElementById("criarPizzaButton");

      // Initialize Firebase
      const firebaseApp = initializeApp(firebaseConfig);
      const db = getFirestore(firebaseApp);
      const pizzaCollectionRef = collection(db, "pizzas");

      async function criarPizza() {
        const sabor = saborInput.value;
        const tamanho = tamanhoInput.value;
        const tipo = tipoInput.value;
        const ingredientes = ingredientesInput.value;

        try {
          await addDoc(pizzaCollectionRef, {
            sabor,
            tamanho,
            tipo,
            ingredientes,
          });
          console.log("Pizza criada com sucesso!");
        } catch (error) {
          console.error("Erro ao criar a pizza:", error);
        }
      }

      document
        .getElementById("acao-button")
        .addEventListener("click", function () {
          criarPizza();
        });

      //criarPizzaButton.addEventListener("acao-button", criarPizza);
      /*
      const getPizzas = async () => {
        const data = await getDocs(pizzaCollectionRef);
        setPizzas(
          data.docs.map((doc) => ({
            ...doc.data(),
            id: doc.id,
          }))
        );
      };
      useEffect(() => {
        getPizzas();
      }, [pizzas]);
      async function deletePizza(id) {
        const pizzaDoc = doc(db, "pizzas", id);
        await deleteDoc(pizzaDoc);
      }
      async function atualizaPizza(id, dados) {
        await setDoc(doc(db, "pizzas", id), dados);
      }
      */
    </script>
  </body>
</html>
